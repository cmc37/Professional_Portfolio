---
title: "Pilot_RCT_BHinPC"
format: html
author: "Cathea M. Carey, MPH"
date: "12/8/25"
output:
  powerpoint_presentation:
    reference_doc: PPT_Template_16x9-A_2023.pptx # UW Branded Template A from: https://www.washington.edu/brand/templates/presentations/
bibliography: references.bib
---

# Background

Behavioral Health (BH) is defined as X. Commonly delivered in Y settings, and in the United States' health care system often are inaccessible to populations who would benefit from BH interventions due to reason A- (cite), reason B (cite), and reason C (cite).

Primary Care (PC) is often a seen as a secondary health care setting that provides primary intervention for both physical and behavioral needs. PC access and utilization are associated with better outcome A - C.

BH interventions in PC have the shown potential to 1) loneliness and 2) depression as this setting have the added benefit of primary intervention or initial identification while the patient is potentially more motivated in PC rather than waiting for a referral (cite) or co-located BH/MH on-site (cite).

This small randomized control trial (RCT) aims to understand the feasibility of a BH intervention in Primary Care. The sample consists of 40 participants, equally weighted in the intervention (BH) and control (Treatment-as-usual or TAU). The data-set consists of intervention arm (BH/TAU), participant demographics (Age, Race/Ethnicity, Gender, and Income), measurement of outcomes (primary = loneliness; secondary = depression) at 3 time points (baseline, 3 months follow-up, and 6 months follow-up), and attendance for all 6 intervention session (Intervention arm = BH only).

# Decision Logs

## Pre-Extract, Transform, and Load (ETL) - Prior to Establishing the Environment

The Pre-Work before starting the assessment began with reviewing the "Skills_Assessment_Instructions.docx" and "data_dictionary.xlsx" files. During Pre-Work for the Assessment, the following thoughts came to mind:

-   What are the standard bins or categories for the following known continuous variables to measure the outcomes (primary = loneliness; secondary = depression):

    -   Age (for this research aim: Behavioral Health Interventions in Primary Care),
    -   PHQ-9 (measure for secondary outcome = depression),
    -   and UCLA - L20 (measure for primary outcome = loneliness)

-   **NOTE:** Gender outputs - Question what source(s) for outputs or standards for Gender were used? I've seen Gender reported as Gender Identify (a specific operationally defined construct with consistent industry standards) and Sexual Identity. I would suggest aligned with Office of Management and Budget's demographic standards back in 2024.

-   Additional Calculated field for Race/Ethnicity since a "self-described" output would likely result in small Ns.

-   **Caution:** Given the small sample size, external publications of findings should follow data suppression standards (such as Journals or Governmental entities).

```{r ETL Part 1, echo=FALSE, warning=FALSE}
library(readxl)
library(purrr)
library(dplyr)

#Data is on external drive
# Check driver for files
list.files("/Volumes/LaCie/DropBox/Github/Skills_Assessment_Dec_2025")
# Check xlsx for sheet names
file_path <- "/Volumes/LaCie/DropBox/Github/Skills_Assessment_Dec_2025/pilot_rct_data.xlsx"  
               sheet_names <- excel_sheets(path = file_path)

# Add sheets as list then transform into DF (left join)
    datalist <- lapply(sheet_names, function(sheet_name) {
      read_excel(path = file_path, sheet = sheet_name)
    })

# Intermediate Data Frames for initial cleaning and final analysis
df_outcomes <- as.data.frame(datalist[[1]])
df_attendance <- as.data.frame(datalist[[2]])

head(df_attendance)
head(df_outcomes)

# Final Data Frame for final analysis featuring left join of df_attendance to df_outcomes
df <- left_join (df_outcomes, df_attendance, by = "record_id")

head(df) 
### END OF ETL PART 1
```

## Post-ETL

### Make Calculated Fields

-   Age (bins)
-   Race/Ethnicity (New Variable Names/Labels)
    1.  Preserves the Categories with new field; one-hot encoding for select all option not needed
-   PHQ-9 Total (by time points)
-   PHQ-9 X Sub-categories (by time points)
    -   [PHQ-9: Validity of a Brief Depression Severity Measure](https://onlinelibrary.wiley.com/doi/full/10.1046/j.1525-1497.2001.016009606.x) (@kroenke2001)
        -   Validation suggests bins of PHQ-9 scores of 5== mild, 10 == moderate, 15 ==moderately severe, and 20 severe depression
-   UCLA-LS-20 Total (by time points)
-   UCLA-LS-20 X Sub-categories (by time points)
    -   [UCLA - LS Scale Article](https://www.cambridge.org/core/journals/psychological-medicine/article/measuring-loneliness-a-headtohead-psychometric-comparison-of-the-3-and-20item-ucla-loneliness-scales/CF99BEB620AF61EAEDCF7B360312F994) (@gosling2024)
        -   Sensitivity analysis suggests exploring cutoff at \>= 39; \>=43; and \>=53
-   Attendance (bins)
    1.  Preserve time-point attendance; additional overall attendance output for high-level trend (signal and keeps option for treatment dosage effects).
        1.  Prop = (full dose/'yes'+ 1/2 partial dose/'partial')/ total dosage (all 6 sessions)
-   Missingness
    -   Create a Flag for records missing 1 or more elements (UCLA-LS-20; PHQ-9; Race/Ethnicity)

```{r ETL Part 2, echo=FALSE, warning=FALSE}
# Create Calculated fields
# Age (bins) - From Continuous Variable to Bins; suggested based on Histogram == 20 - 34, 35 - 49, 50 - 64, 64 and up
hist(df$age) #review original field
df$age_range <-  cut(df$age,
                       breaks=c(20, 35, 49, 64, 80),
                       labels=c('20 - 34 years old', '35 - 49 years old', '50 - 64 years old', '64 years old or older'))

table(df$age_range) #spot check
table(df$age) #reference line for above spot check, note best practice is to call out line # 93

#Race/Ethnicity (New Variable Names/Labels)
table(df$race_ethnicity) #review original field
table(df$race_nl_specify) #review original field
df$raceethnicity_recoded <- case_when(
      df$race_ethnicity == "southeast Asian" ~ "Asian American", #fast hard coding of n = 2 fields to save time, note best practice is to still review
      df$race_ethnicity == "Nigerian" ~ "Black/AA",
      TRUE ~ df$race_ethnicity
    )
table(df$raceethnicity_recoded)

# PHQ-9 Total (by time points)
# Find column numbers and quick calculate
which(names(df) %in% c("ucla_b_1", "ucla_3_1", "ucla_6_1","phq_b_1", "phq_3_1", "phq_6_1", "attend_s1", "attend_s6"))

df$phq_b_total <- rowSums((df[, 68:76])) # Baseline PHQ-9 total
df$phq_3_total <- rowSums((df[, 77:85])) # 3 month PHQ-9 total
df$phq_6_total <- rowSums((df[, 86:94])) # 6 month PHQ-9 total

# PHQ-9 X Sub-categories (by time points) PHQ-9 scores of 5== mild, 10 == moderate, 15 ==moderately severe, and 20 severe depression
df <- df %>% # Baseline PHQ-9 total
  dplyr::mutate(
    phq_b_cat = case_when(
      phq_b_total <= 5 ~ "Mild Depression",
      phq_b_total <= 10 ~ "Moderate Depression",
      phq_b_total <= 15 ~ "Moderate Severe Depression",
      phq_b_total <= 20 ~ "Severe Depression",  
      TRUE ~ NA_character_
    )
  )
df <- df %>% #Factor levels
  mutate(
    phq_b_cat = factor(
      phq_b_cat,
      levels = c("Mild Depression", "Moderate Depression","Moderate Severe Depression","Severe Depression"),
      ordered = TRUE
    )
  )

df <- df %>% # 3 month PHQ-9 total
  dplyr::mutate(
    phq_3_cat = case_when(
      phq_3_total <= 5 ~ "Mild Depression",
      phq_3_total <= 10 ~ "Moderate Depression",
      phq_3_total <= 15 ~ "Moderate Severe Depression",
      phq_3_total <= 20 ~ "Severe Depression",  
      TRUE ~ NA_character_
    )
  )
df <- df %>% #Factor levels
  mutate(
    phq_3_cat = factor(
      phq_3_cat,
      levels = c("Mild Depression", "Moderate Depression","Moderate Severe Depression","Severe Depression"),
      ordered = TRUE
    )
  )

#df$phq_6_cat <- rowSums((df[, 86:94])) 

df <- df %>% # 6 month PHQ-9 total
  dplyr::mutate(
    phq_6_cat = case_when(
      phq_6_total <= 5 ~ "Mild Depression",
      phq_6_total <= 10 ~ "Moderate Depression",
      phq_6_total <= 15 ~ "Moderate Severe Depression",
      phq_6_total <= 20 ~ "Severe Depression",  
      TRUE ~ NA_character_
    )
  )
df <- df %>% #Factor levels
  mutate(
    phq_6_cat = factor(
      phq_6_cat,
      levels = c("Mild Depression", "Moderate Depression","Moderate Severe Depression","Severe Depression"),
      ordered = TRUE
    )
  )

# UCLA-LS-20 Total (by time points) 
df$ucla_b_total <- rowSums((df[, 8:27])) # Baseline UCLA-LS-20 total
df$ucla_3_total <- rowSums((df[, 28:47])) # 3 month UCLA-LS-20 total
df$ucla_6_total <- rowSums((df[, 48:67])) # 6 month UCLA-LS-20 total


# UCLA-LS-20 X Sub-categories (by time points) cutoff at >= 39; >=43; and >=53
df <- df %>% # >= 39; >=43; and >=53
 mutate(  # Baseline UCLA-LS-20 
      uclas_b_cut39 = ifelse(ucla_b_total >= 39, 1, 0),
      uclas_b_cut43 = ifelse(ucla_b_total >= 43, 1, 0),
      uclas_b_cut53 = ifelse(ucla_b_total >= 53, 1, 0)
    )

df <- df %>% # >= 39; >=43; and >=53
 mutate(  # 3 month UCLA-LS-20 
      uclas_3_cut39 = ifelse(ucla_3_total >= 39, 1, 0),
      uclas_3_cut43 = ifelse(ucla_3_total >= 43, 1, 0),
      uclas_3_cut53 = ifelse(ucla_3_total >= 53, 1, 0)
    )

df <- df %>% # >= 39; >=43; and >=53
 mutate(  # 6 month UCLA-LS-20
      uclas_6_cut39 = ifelse(ucla_6_total >= 39, 1, 0),
      uclas_6_cut43 = ifelse(ucla_6_total >= 43, 1, 0),
      uclas_6_cut53 = ifelse(ucla_6_total >= 53, 1, 0)
    )

# Attendance (bins) - prepare for factor analysis of "treatment dosage"
# Doseage
bh_dosage_total <- ncol(df[, 95:100])
df$dosage_prop <- (rowSums(df[, 95:100] == "yes", na.rm = TRUE) + #treats yes as full dosage, partial as half dosage, no as missed dosage
                          0.5 * rowSums(df[, 95:100] == "partial", na.rm = TRUE)) / bh_dosage_total

df$doseage_cat <- cut(
  df$dosage_prop,
  breaks = c(-0.01, 0, 0.33, 0.66, 1),   # include 0 as its own interval
  labels = c("Control", "Minimal Intervention", "Partial Intervention", "Maximum Intervention")
)


# Test look into Attendance as a continuous variable by recoding qual into quan
values <- c("no" = 0, "partial" = 0.5, "yes" = 1)

# Convert and sum rows
df$attend_s_total <- rowSums(
  sapply(df[, 95:100], function(x) values[x]),
  na.rm = TRUE
)


# Make subsets for potential comparison analysis and data quality check
subset_BHarm_df <- subset(df, arm == "Intervention") #spot check to make sure left join was successful = correct attendance for intervention only
subset_TAUarm_df <- subset(df, arm == "Control") #spot check to make sure left join was successful = correct attendance for intervention only

### END OF ETL PART 2
```

## Post-Table 1

# Skills Assessment Documentation:

## Rationale for Specific Output of R

Below is the R Code created to assess the following skills of the author (myself):

-   Ability to handle and prepare real-world data,

-   strategies behind analysis choices,

-   interpretation of results in context of a small, pilot RCT,

-   and overall clarity and accessibility of the communication of the above.

I believe this documentation shows through the RMD function 1) incline comments and choices for project/team documentation and replicability, 2) use of a repository to decrease staff time needed to tailor communication findings to various outputs, and 3) RMD output with PowerPoint Presentation (PPT), Word Document or PDF (industry standard or open source static documents to review), and Webpage (HMTL) for easy intra-team QA/QI for the shared potential increase audience comprehension through multiple outputs with click of a button.
